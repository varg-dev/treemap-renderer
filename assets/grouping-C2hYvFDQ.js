import{t as H,v as N,b as P,c as S}from"./index-C1O4TDP0.js";import{w as E,T as C,N as V,C as M,p as O,E as R,g as B,i as k,V as K}from"./example-CdYP11SK.js";const A=E.auxiliaries.log,I=E.auxiliaries.LogLevel;class W{}const y=class y{static initializeHeader(t){t.csv_delimiter=";",t.groupings=[]}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const n=t.shift().substring(1).trim(),[o,r]=n.split("=").map(c=>c.trim());o=="delimiter"?e.csv_delimiter=r||";":o=="groupings"?e.groupings=(r||"").split("/"):o=="weights"?e.weight_column=r||"":o=="heights"?e.height_column=r||"":o=="colors"?e.color_column=r||"":o=="labels"?e.label_column=r||"":A(I.Warning,"Unparsed header",o,"=",r)}}static parsePapaparseResult(t,e,n){const o=(i,a)=>i.meta.fields.indexOf(a)<0?new Array(i.data.length):i.data.map(s=>s[a]?parseFloat(s[a]):-1),r=i=>t.meta.fields.indexOf(i)>=0,c=(i,a)=>i.meta.fields.indexOf(a)<0?new Array(i.data.length):i.data.map(s=>s[a]?s[a]:""),b=o(t,e.weight_column),x=o(t,e.height_column),h=o(t,e.color_column),z=c(t,e.label_column),p=(i,a)=>({parentIndex:a,index:i}),u=(i,a,g)=>{const s=["",""];for(let m=0;m<a;++m)s[m+1]=g[i[m]]||"-";return s.join("/")},f=new Array,w=new Map,l={};let d=-1;l["/"]=p(d,-1),d+=1;const v=e.groupings;v.forEach((i,a)=>{t.data.forEach(g=>{const s=u(v,a,g),m=u(v,a+1,g);if(!(s in l)){A(I.Warning,s,"not in",l);return}m in l||(l[m]=p(d,l[s].index),f.push(l[m].parentIndex),f.push(d),w.set(d,g[v[a]]),d+=1)})});const _=d+1;if(t.data.forEach(i=>{const a=u(v,v.length,i);if(!(a in l)){A(I.Warning,a,"not in",l);return}f.push(l[a].index),f.push(d),d+=1}),n.topology={edges:f,semantics:C.InputSemantics.ParentIdId,format:C.InputFormat.Interleaved},n.buffers=[{identifier:"source-weights",type:"numbers",data:new Array(_).fill(0).concat(b),linearization:"topology"},{identifier:"source-heights",type:"numbers",data:new Array(_).fill(0).concat(x),linearization:"topology"},{identifier:"source-colors",type:"numbers",data:new Array(_).fill(0).concat(h),linearization:"topology"}],n.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],n.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"inferno",steps:7}],n.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:V.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},n.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},r(e.label_column))for(let i=0;i<z.length;++i)w.set(i+_-1,z[i]);n.labels={innerNodeLayerRange:[0,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:w},n.altered.alter("any")}static loadAsync(t){const e=new W;y.initializeHeader(e);const n=t.split(`
`);y.parseHeader(n,e);const o=n.join(`
`);return this.loadAsyncHeader(o,e)}static loadAsyncHeader(t,e){return new Promise((n,o)=>{const r=new M;O.parse(t,{error:c=>o(c),complete:c=>{y.parsePapaparseResult(c,e,r),n(r)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};y.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let T=y;const $=E.auxiliaries.log,q=E.auxiliaries.LogLevel;class F extends R{obtainUrl(t){return window.location.origin+window.location.pathname+"?data="+t}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=window.document.getElementById("csv-data"),n=window.document.getElementById("data-hash"),o=window.document.getElementById("reload"),r=window.document.getElementById("config-display"),c=this.initialize(t),b=this._visualization.renderer,x=this._canvas,h=this._visualization,z=p=>{const u=h.configuration;try{h.configuration=p,b.invalidate(),r&&(r.textContent=JSON.stringify(p.toJSON(),null,2))}catch{h.configuration=u,b.invalidate()}};if(window.gloperate=B,window.canvas=x,window.context=x.context,window.controller=x.controller,window.visualization=h,window.renderer=b,e){const u=new URLSearchParams(window.location.search).get("data");u&&($(q.Debug,"Load from",u),e.value=atob(u)),e.oninput=f=>{const w=e.value;T.loadAsync(w).then(l=>{z(l),n&&(n.textContent=this.obtainUrl(btoa(w)))})},e.oninput({})}return o&&n&&(o.onclick=p=>{n.textContent&&n.textContent!==""&&(window.location.href=n.textContent)}),c&&e!==void 0&&e!==null}initialize(t){this._canvas=k(t),this._visualization=new K;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const L=document.getElementById("canvas"),t=new F;window.example=t,t.feature(L);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=H;document.title="treemap-renderer";document.querySelector("#version").innerHTML=N();document.querySelector("#branch").innerHTML=P();document.querySelector("#commit").innerHTML=S();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
