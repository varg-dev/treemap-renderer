import{t as S,v as P,b as k,c as M}from"./index-DRUcNu7V.js";import{w as L,T as V,N as R,C as F,E as B,g as W,i as q,V as O}from"./example-CAmKpJUL.js";import{p as K}from"./papaparse.min-D1KxGBLm.js";const C=L.auxiliaries.log,N=L.auxiliaries.LogLevel;class U{}const g=class g{static initializeHeader(t){t.csv_delimiter=";",t.path_column="name"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const r=t.shift().substring(1).trim(),[o,n]=r.split("=").map(u=>u.trim());o=="delimiter"?e.csv_delimiter=n||";":o=="paths"?e.path_column=n||"name":o=="weights"?e.weight_column=n||"":o=="heights"?e.height_column=n||"":o=="colors"?e.color_column=n||"":o=="labels"?e.label_column=n||"":o=="heightScale"?e.height_scale=Number.parseFloat(n||"0.1")||.1:C(N.Warning,"Unparsed header",o,"=",n)}}static parsePapaparseResult(t,e,r){const o=(i,a)=>i.meta.fields.indexOf(a)<0?new Array(i.data.length):i.data.map(l=>l[a]?l[a]:""),n=(i,a)=>{if(i.meta.fields.indexOf(a)<0){const l=new Array(i.data.length);return l.fill(-1),l}return i.data.map(l=>l[a]?parseFloat(l[a]):-1)},u=i=>t.meta.fields.indexOf(i)>=0,m=o(t,e.path_column);for(let i=0;i<m.length;++i)m[i]=m[i].replace("./","");const y=m.map(i=>i.split("/")),z=n(t,e.weight_column),x=n(t,e.height_column),f=n(t,e.color_column);u(e.label_column)?o(t,e.label_column):y.map(i=>i.at(-1));const s=(i,a)=>({parentIndex:a,index:i}),d=(i,a)=>"/"+i.slice(0,a).join("/"),c=new Array,H=new Map,w=new Array,v=new Array,b=new Array,p={};let h=-1;p["/"]=s(h,-1),h+=1,w.push(0),v.push(0),b.push(0),y.forEach((i,a)=>{i.forEach((A,l)=>{const T=d(i,l),E=d(i,l+1);if(!(T in p)){C(N.Warning,T,"not in",p);return}E in p||(p[E]=s(h,p[T].index),c.push(p[E].parentIndex),c.push(h),H.set(h,A),h+=1,l==i.length-1?(w.push(z[a]),v.push(x[a]),b.push(f[a])):(w.push(0),v.push(0),b.push(0)))})}),r.topology={edges:c,semantics:V.InputSemantics.ParentIdId,format:V.InputFormat.Interleaved},r.buffers=[{identifier:"source-weights",type:"numbers",data:w,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:v,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:b,linearization:"topology"}],r.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:1,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],r.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Greens",steps:7}],r.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:R.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},r.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:e.height_scale},r.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:H},r.altered.alter("any")}static loadAsync(t){const e=new U;g.initializeHeader(e);const r=t.split(`
`);g.parseHeader(r,e);const o=r.join(`
`);return this.loadAsyncHeader(o,e)}static loadAsyncHeader(t,e){return new Promise((r,o)=>{const n=new F;K.parse(t,{error:u=>o(u),complete:u=>{g.parsePapaparseResult(u,e,n),r(n)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};g.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let I=g;class $ extends B{get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=this.initialize(t),r=this._visualization.renderer,o=this._canvas,n=this._visualization,u=o.element;window.document.getElementById("fullscreen").onclick=()=>{L.viewer.Fullscreen.toggle(u)};const m=f=>{const s=n.configuration;try{n.configuration=f,n.update(),r.invalidate()}catch(d){if(console.log(d),s===void 0)return;const c=new F;c.topology=s.topology,c.layout=s.layout,c.buffers=s.buffers,c.bufferViews=s.bufferViews,c.colors=s.colors,c.geometry=s.geometry,c.labels=s.labels,n.configuration=c,n.update(),r.invalidate()}},y=document.getElementById("fileUpload"),z=document.getElementById("loadFile"),x=async()=>{const f=y.files;if(f===null)return;const s=f[0];s!==void 0&&s.text().then(d=>I.loadAsync(d)).then(d=>m(d))};return z.onclick=async()=>x(),window.gloperate=W,window.canvas=o,window.context=o.context,window.controller=o.controller,window.visualization=n,window.renderer=r,e}initialize(t){this._canvas=q(t),this._visualization=new O;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const _=document.getElementById("canvas"),t=new $;window.example=t,t.feature(_);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=S;document.title="treemap-renderer";document.querySelector("#version").innerHTML=P();document.querySelector("#branch").innerHTML=k();document.querySelector("#commit").innerHTML=M();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
