import{t as H,v as P,b as N,c as V}from"./index-DIdt5DjF.js";import{w as L,N as S,T as C,C as M,p as R,E as k,g as B,i as K,V as O}from"./example-B1gPw968.js";const A=L.auxiliaries.log,I=L.auxiliaries.LogLevel;class W{}const w=class w{static initializeHeader(e){e.csv_delimiter=";",e.groupings=[]}static initializeConfig(e){e.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"inferno",steps:7}],e.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:S.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},e.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},e.labels={innerNodeLayerRange:[0,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50}}static parseHeader(e,t){for(;e.length>=1&&e[0].startsWith("#");){const r=e.shift().substring(1).trim(),[i,o]=r.split("=").map(c=>c.trim());i=="delimiter"?t.csv_delimiter=o||";":i=="groupings"?t.groupings=(o||"").split("/"):i=="weights"?t.weight_column=o||"":i=="heights"?t.height_column=o||"":i=="colors"?t.color_column=o||"":i=="labels"?t.label_column=o||"":A(I.Warning,"Unparsed header",i,"=",o)}}static parsePapaparseResult(e,t,r){const i=(n,a)=>n.meta.fields.indexOf(a)<0?new Array(n.data.length):n.data.map(s=>s[a]?parseFloat(s[a]):-1),o=n=>e.meta.fields.indexOf(n)>=0,c=(n,a)=>n.meta.fields.indexOf(a)<0?new Array(n.data.length):n.data.map(s=>s[a]?s[a]:""),d=i(e,t.weight_column),m=i(e,t.height_column),z=i(e,t.color_column),v=c(e,t.label_column),p=(n,a)=>({parentIndex:a,index:n}),b=(n,a,h)=>{const s=["",""];for(let g=0;g<a;++g)s[g+1]=h[n[g]]||"-";return s.join("/")},f=new Array,x=new Map,l={};let u=-1;l["/"]=p(u,-1),u+=1;const y=t.groupings;y.forEach((n,a)=>{e.data.forEach(h=>{const s=b(y,a,h),g=b(y,a+1,h);if(!(s in l)){A(I.Warning,s,"not in",l);return}g in l||(l[g]=p(u,l[s].index),f.push(l[g].parentIndex),f.push(u),x.set(u,h[y[a]]),u+=1)})});const _=u+1;if(e.data.forEach(n=>{const a=b(y,y.length,n);if(!(a in l)){A(I.Warning,a,"not in",l);return}f.push(l[a].index),f.push(u),u+=1}),r.topology={edges:f,semantics:C.InputSemantics.ParentIdId,format:C.InputFormat.Interleaved},r.buffers=[{identifier:"source-weights",type:"numbers",data:new Array(_).fill(0).concat(d),linearization:"topology"},{identifier:"source-heights",type:"numbers",data:new Array(_).fill(0).concat(m),linearization:"topology"},{identifier:"source-colors",type:"numbers",data:new Array(_).fill(0).concat(z),linearization:"topology"}],r.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],o(t.label_column))for(let n=0;n<v.length;++n)x.set(n+_-1,v[n]);r.labels.names=x,r.altered.alter("any")}static loadAsync(e){const t=new W;w.initializeHeader(t);const r=e.split(`
`);w.parseHeader(r,t);const i=r.join(`
`);return this.loadAsyncHeader(i,t)}static loadAsyncHeader(e,t){return new Promise((r,i)=>{const o=new M;w.initializeConfig(o),R.parse(e,{error:c=>i(c),complete:c=>{w.parsePapaparseResult(c,t,o),r(o)},delimiter:t.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};w.FAILED=(e,t)=>`fetching '${e}' failed (${t.status}): ${t.statusText}`;let T=w;const $=L.auxiliaries.log,q=L.auxiliaries.LogLevel;class F extends k{obtainUrl(e){return window.location.origin+window.location.pathname+"?data="+e}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(e){return this.initialize(e)}preview(e){return this.initialize(e)}feature(e){const t=this.initialize(e),r=this._visualization.renderer,i=this._canvas,o=this._visualization,c=v=>{const p=o.configuration;try{o.configuration=v,r.invalidate()}catch{o.configuration=p,r.invalidate()}};window.gloperate=B,window.canvas=i,window.context=i.context,window.controller=i.controller,window.visualization=o,window.renderer=r;const d=window.document.getElementById("csv-data"),m=window.document.getElementById("data-hash"),z=window.document.getElementById("reload");if(d!==void 0){const p=new URLSearchParams(window.location.search).get("data");p&&($(q.Debug,"Load from",p),d.value=atob(p)),d.oninput=b=>{const f=d.value;T.loadAsync(f).then(x=>{c(x),m!==void 0&&(m.textContent=this.obtainUrl(btoa(f)))})},d.oninput({})}return z!==void 0&&m!==void 0&&(z.onclick=v=>{m.textContent!==void 0&&m.textContent!==""&&(window.location.href=m.textContent)}),t&&d!==void 0}initialize(e){this._canvas=K(e),this._visualization=new O;const t=this._visualization.renderer;return this._canvas.renderer=t,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const E=document.getElementById("canvas"),e=new F;window.example=e,e.feature(E);const t=window.document.getElementById("context-about");t&&(t.innerText=context.aboutString())};window.treemaprenderer=H;document.title="treemap-renderer";document.querySelector("#version").innerHTML=P();document.querySelector("#branch").innerHTML=N();document.querySelector("#commit").innerHTML=V();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
