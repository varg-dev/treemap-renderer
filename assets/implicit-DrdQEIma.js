import{t as S,v as k,b as B,c as M}from"./index-DRUcNu7V.js";import{w as b,T as H,N as R,C as V,E as O,g as F,i as W,V as $}from"./example-CAmKpJUL.js";import{p as q}from"./papaparse.min-D1KxGBLm.js";const N=b.auxiliaries.log,P=b.auxiliaries.LogLevel;class U{}const v=class v{static initializeHeader(t){t.csv_delimiter=";",t.path_column="name"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const i=t.shift().substring(1).trim(),[o,a]=i.split("=").map(u=>u.trim());o=="delimiter"?e.csv_delimiter=a||";":o=="paths"?e.path_column=a||"name":o=="weights"?e.weight_column=a||"":o=="heights"?e.height_column=a||"":o=="colors"?e.color_column=a||"":o=="labels"?e.label_column=a||"":N(P.Warning,"Unparsed header",o,"=",a)}}static parsePapaparseResult(t,e,i){const o=(n,s)=>n.meta.fields.indexOf(s)<0?new Array(n.data.length):n.data.map(c=>c[s]?c[s]:""),a=(n,s)=>n.meta.fields.indexOf(s)<0?new Array(n.data.length):n.data.map(c=>c[s]?parseFloat(c[s]):-1),u=n=>t.meta.fields.indexOf(n)>=0,d=o(t,e.path_column);for(let n=0;n<d.length;++n)d[n]=d[n].replace("./","");const p=d.map(n=>n.split("/")),m=a(t,e.weight_column),E=a(t,e.height_column),L=a(t,e.color_column);u(e.label_column)?o(t,e.label_column):p.map(n=>n.at(-1));const h=(n,s)=>({parentIndex:s,index:n}),r=(n,s)=>"/"+n.slice(0,s).join("/"),g=new Array,l=new Map,w=new Array,x=new Array,z=new Array,f={};let y=-1;f["/"]=h(y,-1),y+=1,w.push(0),x.push(0),z.push(0),p.forEach((n,s)=>{n.forEach((A,c)=>{const I=r(n,c),T=r(n,c+1);if(!(I in f)){N(P.Warning,I,"not in",f);return}T in f||(f[T]=h(y,f[I].index),g.push(f[T].parentIndex),g.push(y),l.set(y,A),y+=1,c==n.length-1?(w.push(m[s]),x.push(E[s]),z.push(L[s])):(w.push(0),x.push(0),z.push(0)))})}),i.topology={edges:g,semantics:H.InputSemantics.ParentIdId,format:H.InputFormat.Interleaved},i.buffers=[{identifier:"source-weights",type:"numbers",data:w,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:x,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:z,linearization:"topology"}],i.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],i.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Greens",steps:7}],i.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:R.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},i.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},i.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:l},i.altered.alter("any")}static loadAsync(t){const e=new U;v.initializeHeader(e);const i=t.split(`
`);v.parseHeader(i,e);const o=i.join(`
`);return this.loadAsyncHeader(o,e)}static loadAsyncHeader(t,e){return new Promise((i,o)=>{const a=new V;q.parse(t,{error:u=>o(u),complete:u=>{v.parsePapaparseResult(u,e,a),i(a)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};v.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let C=v;const K=b.auxiliaries.log,j=b.auxiliaries.LogLevel;class J extends O{obtainUrl(t){return window.location.origin+window.location.pathname+"?data="+t}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=window.document.getElementById("csv-data"),i=window.document.getElementById("data-hash"),o=window.document.getElementById("reload"),a=window.document.getElementById("config-display"),u=this.initialize(t),d=this._visualization.renderer,p=this._canvas,m=this._visualization,E=p.element;window.document.getElementById("fullscreen").onclick=()=>{b.viewer.Fullscreen.toggle(E)};const L=h=>{const r=m.configuration;try{m.configuration=h,m.update(),d.invalidate(),a&&(a.textContent=JSON.stringify(h.toJSON(),null,2))}catch(g){if(console.log(g),r===void 0)return;const l=new V;l.topology=r.topology,l.layout=r.layout,l.buffers=r.buffers,l.bufferViews=r.bufferViews,l.colors=r.colors,l.geometry=r.geometry,l.labels=r.labels,m.configuration=l,m.update(),d.invalidate()}};if(window.gloperate=F,window.canvas=p,window.context=p.context,window.controller=p.controller,window.visualization=m,window.renderer=d,e){const r=new URLSearchParams(window.location.search).get("data");r&&(K(j.Debug,"Load from",r),e.value=atob(r)),e.oninput=g=>{const l=e.value;C.loadAsync(l).then(w=>{L(w),i&&(i.textContent=this.obtainUrl(btoa(l)))})},e.oninput({})}return o&&i&&(o.onclick=h=>{i.textContent&&i.textContent!==""&&(window.location.href=i.textContent)}),u&&e!==void 0&&e!==null}initialize(t){this._canvas=W(t),this._visualization=new $;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const _=document.getElementById("canvas"),t=new J;window.example=t,t.feature(_);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=S;document.title="treemap-renderer";document.querySelector("#version").innerHTML=k();document.querySelector("#branch").innerHTML=B();document.querySelector("#commit").innerHTML=M();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
