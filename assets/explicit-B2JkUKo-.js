import{t as z,v as L,b as E,c as I}from"./index-CpFY1vd5.js";import{w as v,N as A,T as _,C as T,p as C,E as H,g as V,i as M,V as P}from"./example-B1gPw968.js";const R=v.auxiliaries.log,S=v.auxiliaries.LogLevel;class N{}const d=class d{static initializeHeader(e){e.id_column="ids",e.parent_column="parents"}static initializeConfig(e){e.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Oranges",steps:7}],e.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:A.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},e.geometry={parentLayer:{showRoot:!0},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},e.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50}}static parseHeader(e,t){for(;e.length>=1&&e[0].startsWith("#");){const r=e.shift().substring(1).trim(),[o,n]=r.split("=").map(c=>c.trim());o=="ids"?t.id_column=n:o=="parents"?t.parent_column=n:o=="weights"?t.weight_column=n:o=="heights"?t.height_column=n:o=="colors"?t.color_column=n:o=="labels"?t.label_column=n:R(S.Warning,"Unparsed header",o,"=",n)}}static parsePapaparseResult(e,t,r){const o=(i,a)=>{if(i.meta.fields.indexOf(a)<0)return new Uint32Array(i.data.length);const p=i.data.map(s=>s[a]?s[a]:0);return Uint32Array.from(p)},n=(i,a)=>{if(i.meta.fields.indexOf(a)<0)return new Float32Array(i.data.length);const p=i.data.map(s=>s[a]?s[a]:-1);return Float32Array.from([0].concat(p))},c=i=>e.meta.fields.indexOf(i)>=0,u=(i,a)=>i.meta.fields.indexOf(a)<0?new Array(i.data.length):i.data.map(s=>s[a]?s[a]:""),l=o(e,t.id_column),w=o(e,t.parent_column),h=n(e,t.weight_column),m=n(e,t.height_column),b=n(e,t.color_column),f=u(e,t.label_column),g=new Array;for(let i=0;i<l.length;i++){const a=l[i],p=w[i];g.push(p),g.push(a)}if(r.topology={edges:g,semantics:_.InputSemantics.ParentIdId,format:_.InputFormat.Interleaved},r.buffers=[{identifier:"source-weights",type:"numbers",data:h,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:m,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:b,linearization:"topology"}],r.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],c(t.label_column)){const i=new Map;for(let a=0;a<f.length;++a)i.set(l[a],f[a]);r.labels.names=i}r.altered.alter("any")}static loadAsync(e){const t=new N;d.initializeHeader(t);const r=e.split(`
`);d.parseHeader(r,t);const o=r.join(`
`);return this.loadAsyncHeader(o,t)}static loadAsyncHeader(e,t){return new Promise((r,o)=>{const n=new T;d.initializeConfig(n),C.parse(e,{error:c=>o(c),complete:c=>{d.parsePapaparseResult(c,t,n),r(n)},delimiter:d.CSV_FIELD_DELIMITER,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};d.CSV_FIELD_DELIMITER=";",d.FAILED=(e,t)=>`fetching '${e}' failed (${t.status}): ${t.statusText}`;let x=d;const F=v.auxiliaries.log,O=v.auxiliaries.LogLevel;class U extends H{obtainUrl(e){return window.location.origin+window.location.pathname+"?data="+e}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(e){return this.initialize(e)}preview(e){return this.initialize(e)}feature(e){const t=this.initialize(e),r=this._visualization.renderer,o=this._canvas,n=this._visualization,c=h=>{const m=n.configuration;try{n.configuration=h,r.invalidate()}catch{n.configuration=m,r.invalidate()}};window.gloperate=V,window.canvas=o,window.context=o.context,window.controller=o.controller,window.visualization=n,window.renderer=r;const u=window.document.getElementById("csv-data"),l=window.document.getElementById("data-hash"),w=window.document.getElementById("reload");if(u!==void 0){const m=new URLSearchParams(window.location.search).get("data");m&&(F(O.Debug,"Load from",m),u.value=atob(m)),u.oninput=b=>{const f=u.value;x.loadAsync(f).then(g=>{c(g),l!==void 0&&(l.textContent=this.obtainUrl(btoa(f)))})},u.oninput({})}return w!==void 0&&l!==void 0&&(w.onclick=h=>{l.textContent!==void 0&&l.textContent!==""&&(window.location.href=l.textContent)}),t&&u!==void 0}initialize(e){this._canvas=M(e),this._visualization=new P;const t=this._visualization.renderer;return this._canvas.renderer=t,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const y=document.getElementById("canvas"),e=new U;window.example=e,e.feature(y);const t=window.document.getElementById("context-about");t&&(t.innerText=context.aboutString())};window.treemaprenderer=z;document.title="treemap-renderer";document.querySelector("#version").innerHTML=L();document.querySelector("#branch").innerHTML=E();document.querySelector("#commit").innerHTML=I();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
