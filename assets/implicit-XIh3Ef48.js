import{t as V,v as S,b as M,c as R}from"./index-DIdt5DjF.js";import{w as _,N as k,T as H,C as B,p as W,E as $,g as q,i as F,V as O}from"./example-B1gPw968.js";const P=_.auxiliaries.log,N=_.auxiliaries.LogLevel;class U{}const p=class p{static initializeHeader(e){e.csv_delimiter=";",e.path_column="name"}static initializeConfig(e){e.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Greens",steps:7}],e.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:k.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},e.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},e.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50}}static parseHeader(e,t){for(;e.length>=1&&e[0].startsWith("#");){const o=e.shift().substring(1).trim(),[a,n]=o.split("=").map(c=>c.trim());a=="delimiter"?t.csv_delimiter=n||";":a=="paths"?t.path_column=n||"name":a=="weights"?t.weight_column=n||"":a=="heights"?t.height_column=n||"":a=="colors"?t.color_column=n||"":a=="labels"?t.label_column=n||"":P(N.Warning,"Unparsed header",a,"=",n)}}static parsePapaparseResult(e,t,o){const a=(i,r)=>i.meta.fields.indexOf(r)<0?new Array(i.data.length):i.data.map(l=>l[r]?l[r]:""),n=(i,r)=>i.meta.fields.indexOf(r)<0?new Array(i.data.length):i.data.map(l=>l[r]?parseFloat(l[r]):-1),c=i=>e.meta.fields.indexOf(i)>=0,s=a(e,t.path_column);for(let i=0;i<s.length;++i)s[i]=s[i].replace("./","");const u=s.map(i=>i.split("/")),v=n(e,t.weight_column),f=n(e,t.height_column),d=n(e,t.color_column);c(t.label_column)?a(e,t.label_column):u.map(i=>i.at(-1));const y=(i,r)=>({parentIndex:r,index:i}),g=(i,r)=>"/"+i.slice(0,r).join("/"),w=new Array,T=new Map,b=new Array,z=new Array,x=new Array,m={};let h=-1;m["/"]=y(h,-1),h+=1,b.push(0),z.push(0),x.push(0),u.forEach((i,r)=>{i.forEach((E,l)=>{const A=g(i,l),C=g(i,l+1);if(!(A in m)){P(N.Warning,A,"not in",m);return}C in m||(m[C]=y(h,m[A].index),w.push(m[C].parentIndex),w.push(h),T.set(h,E),h+=1,l==i.length-1?(b.push(v[r]),z.push(f[r]),x.push(d[r])):(b.push(0),z.push(0),x.push(0)))})}),o.topology={edges:w,semantics:H.InputSemantics.ParentIdId,format:H.InputFormat.Interleaved},o.buffers=[{identifier:"source-weights",type:"numbers",data:b,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:z,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:x,linearization:"topology"}],o.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],o.labels.names=T,o.altered.alter("any")}static loadAsync(e){const t=new U;p.initializeHeader(t);const o=e.split(`
`);p.parseHeader(o,t);const a=o.join(`
`);return this.loadAsyncHeader(a,t)}static loadAsyncHeader(e,t){return new Promise((o,a)=>{const n=new B;p.initializeConfig(n),W.parse(e,{error:c=>a(c),complete:c=>{p.parsePapaparseResult(c,t,n),o(n)},delimiter:t.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};p.FAILED=(e,t)=>`fetching '${e}' failed (${t.status}): ${t.statusText}`;let I=p;const K=_.auxiliaries.log,j=_.auxiliaries.LogLevel;class D extends ${obtainUrl(e){return window.location.origin+window.location.pathname+"?data="+e}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(e){return this.initialize(e)}preview(e){return this.initialize(e)}feature(e){const t=this.initialize(e),o=this._visualization.renderer,a=this._canvas,n=this._visualization,c=f=>{const d=n.configuration;try{n.configuration=f,o.invalidate()}catch{n.configuration=d,o.invalidate()}};window.gloperate=q,window.canvas=a,window.context=a.context,window.controller=a.controller,window.visualization=n,window.renderer=o;const s=window.document.getElementById("csv-data"),u=window.document.getElementById("data-hash"),v=window.document.getElementById("reload");if(s!==void 0){const d=new URLSearchParams(window.location.search).get("data");d&&(K(j.Debug,"Load from",d),s.value=atob(d)),s.oninput=y=>{const g=s.value;I.loadAsync(g).then(w=>{c(w),u!==void 0&&(u.textContent=this.obtainUrl(btoa(g)))})},s.oninput({})}return v!==void 0&&u!==void 0&&(v.onclick=f=>{u.textContent!==void 0&&u.textContent!==""&&(window.location.href=u.textContent)}),t&&s!==void 0}initialize(e){this._canvas=F(e),this._visualization=new O;const t=this._visualization.renderer;return this._canvas.renderer=t,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const L=document.getElementById("canvas"),e=new D;window.example=e,e.feature(L);const t=window.document.getElementById("context-about");t&&(t.innerText=context.aboutString())};window.treemaprenderer=V;document.title="treemap-renderer";document.querySelector("#version").innerHTML=S();document.querySelector("#branch").innerHTML=M();document.querySelector("#commit").innerHTML=R();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
