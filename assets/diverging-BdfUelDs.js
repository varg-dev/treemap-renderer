import{t as E,v as L,b as A,c as I}from"./index-yrmQOoAm.js";import{w,T as x,N as T,C as z,E as C,g as H,i as N,V as S}from"./example-D6mntx4T.js";import{p as V}from"./papaparse.min-lL-0_K96.js";const B=w.auxiliaries.log,P=w.auxiliaries.LogLevel;class F{constructor(){this.csv_delimiter=";",this.id_column="",this.parent_column="",this.weight_column="",this.height_column="",this.color_column="",this.neutral_element=.5,this.label_column=""}}const g=class g{static initializeHeader(t){t.csv_delimiter=";",t.id_column="ids",t.parent_column="parents"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const i=t.shift().substring(1).trim(),[a,r]=i.split("=").map(c=>c.trim());a=="delimiter"?e.csv_delimiter=r||";":a=="ids"?e.id_column=r||"ids":a=="parents"?e.parent_column=r||"parents":a=="weights"?e.weight_column=r||"":a=="heights"?e.height_column=r||"":a=="colors"?e.color_column=r||"":a=="neutralElement"?e.neutral_element=parseFloat(r)||e.neutral_element:a=="labels"?e.label_column=r||"":B(P.Warning,"Unparsed header",a,"=",r)}}static parsePapaparseResult(t,e,i){const a=(n,o)=>{if(n.meta.fields.indexOf(o)<0)return new Uint32Array(n.data.length);const f=n.data.map(l=>l[o]?l[o]:0);return Uint32Array.from(f)},r=(n,o)=>{if(n.meta.fields.indexOf(o)<0)return new Float32Array(n.data.length);const f=n.data.map(l=>l[o]?l[o]:-1);return Float32Array.from([0].concat(f))},c=n=>t.meta.fields.indexOf(n)>=0,h=(n,o)=>n.meta.fields.indexOf(o)<0?new Array(n.data.length):n.data.map(l=>l[o]?l[o]:""),u=a(t,e.id_column),d=a(t,e.parent_column),v=r(t,e.weight_column),_=r(t,e.height_column),m=r(t,e.color_column),s=h(t,e.label_column),p=new Array;for(let n=0;n<u.length;n++){const o=u[n],f=d[n];p.push(f),p.push(o)}if(i.topology={edges:p,semantics:x.InputSemantics.ParentIdId,format:x.InputFormat.Interleaved},i.buffers=[{identifier:"source-weights",type:"numbers",data:v,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:_,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:m,linearization:"topology"}],i.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"normalize",operation:"diverging",neutralElement:e.neutral_element}]}],c(e.label_column)){const n=new Map;for(let o=0;o<s.length;++o)n.set(u[o],s[o]);i.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:n}}i.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"BrBG",steps:7}],i.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:T.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},i.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized",colorsNormalized:!0},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},i.altered.alter("any")}static loadAsync(t){const e=new F;g.initializeHeader(e);const i=t.split(`
`);g.parseHeader(i,e);const a=i.join(`
`);return this.loadAsyncHeader(a,e)}static loadAsyncHeader(t,e){return new Promise((i,a)=>{const r=new z;V.parse(t,{error:c=>a(c),complete:c=>{g.parsePapaparseResult(c,e,r),i(r)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};g.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let b=g;const M=w.auxiliaries.log,O=w.auxiliaries.LogLevel;class R extends C{obtainUrl(t){return window.location.origin+window.location.pathname+"?data="+t}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=window.document.getElementById("csv-data"),i=window.document.getElementById("data-hash"),a=window.document.getElementById("reload"),r=window.document.getElementById("config-display"),c=this.initialize(t),h=this._visualization.renderer,u=this._canvas,d=this._visualization,v=u.element;window.document.getElementById("fullscreen").onclick=()=>{w.viewer.Fullscreen.toggle(v)};const _=m=>{const s=d.configuration;try{d.configuration=m,d.update(),h.invalidate(),r&&(r.textContent=JSON.stringify(m.toJSON(),null,2))}catch(p){if(console.log(p),s===void 0)return;const n=new z;n.topology=s.topology,n.layout=s.layout,n.buffers=s.buffers,n.bufferViews=s.bufferViews,n.colors=s.colors,n.geometry=s.geometry,n.labels=s.labels,d.configuration=n,d.update(),h.invalidate()}};if(window.gloperate=H,window.canvas=u,window.context=u.context,window.controller=u.controller,window.visualization=d,window.renderer=h,e){const s=new URLSearchParams(window.location.search).get("data");s&&(M(O.Debug,"Load from",s),e.value=atob(s)),e.oninput=p=>{const n=e.value;b.loadAsync(n).then(o=>{_(o),i&&(i.textContent=this.obtainUrl(btoa(n)))})},e.oninput({})}return a&&i&&(a.onclick=m=>{i.textContent&&i.textContent!==""&&(window.location.href=i.textContent)}),c&&e!==void 0&&e!==null}initialize(t){this._canvas=N(t),this._visualization=new S;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const y=document.getElementById("canvas"),t=new R;window.example=t,t.feature(y);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=E;document.title="treemap-renderer";document.querySelector("#version").innerHTML=L();document.querySelector("#branch").innerHTML=A();document.querySelector("#commit").innerHTML=I();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
