(function(){"use strict";function p(e,t,n=""){let r=0,s;for(;(s=e.indexOf(`
`,r))!==-1;){const a=e.charAt(s-1)==="\r",u=e.substring(r,s-(a?1:0));r===0?t.push(n+u):t.push(u),r=s+1}return e.substring(r)}function F(e,t,n){return t.chunk===n.chunk?U(e[t.chunk],t,n):v(e,t,n)}function U(e,t,n){const r=new TextDecoder,s=new Array,a=new Uint8Array(e,t.char,n.char-t.char),u=p(r.decode(a),s);return s.push(u),s}function v(e,t,n){const r=new TextDecoder,s={stream:!0},a=new Array;let u="";const l=new Uint8Array(e[t.chunk],t.char);u=p(r.decode(l,s),a,u);for(let f=t.chunk+1;f<n.chunk;f++)u=p(r.decode(e[f],s),a,u);const o=new Uint8Array(e[n.chunk],0,n.char);return u=p(r.decode(o),a,u),a.push(u),a}var i=(e=>(e.Number="number",e.Int8="int8",e.Uint8="uint8",e.Int16="int16",e.Uint16="uint16",e.Int32="int32",e.Uint32="uint32",e.Float32="float32",e.Float64="float64",e.Color="color",e.String="string",e.Date="date",e))(i||{});function w(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":case"number":return 4;case"float64":case"date":return 8;case"color":return 16;case"string":default:return 0}}function x(e){switch(e){case"number":case"float32":case"float64":return!0;default:return!1}}function y(e){switch(e){case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return!0;default:return!1}}const E=1,S=new RegExp(/^(#|0x)?(([0-9a-f]{3}){1,2}|([0-9a-f]{4}){1,2})$/i);function R(e,t=!1){const n=[0,0,0,E];if(!S.test(e))return t||console.warn("hexadecimal RGBA color string must conform to either","#0000, or #00000000, given",e),n;const r=e.startsWith("0x")?2:e.startsWith("#")?1:0,s=Math.floor((e.length-r)/3),a=s-1;return n[0]=parseInt(e[r+0*s]+e[r+0*s+a],16)/255,n[1]=parseInt(e[r+1*s]+e[r+1*s+a],16)/255,n[2]=parseInt(e[r+2*s]+e[r+2*s+a],16)/255,(e.length-r===4||e.length-r===8)&&(n[3]=parseInt(e[r+3*s]+e[r+3*s+a],16)/255),!t&&(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3]))&&console.warn(`expected well formatted hexadecimal RGBA string, given '${e}'`),n}function L(e,t){return e.map((n,r)=>{if(x(t[r]))return Number.parseFloat(n);if(y(t[r]))return Number.parseInt(n);switch(t[r]){case i.Color:return R(n);case i.Date:{let s=Date.parse(n);return isNaN(s)&&(s=Number.parseInt(n)),new Date(s)}case i.String:return n;default:return}})}function _(e,t){return t?new SharedArrayBuffer(e):new ArrayBuffer(e)}function B(e,t){let n=e.length;for(;n--;)if(t(e[n],n,e))return n;return-1}function V(e,t){const s={chunk:0,char:0},a={chunk:0,char:0};let u,l,o=0;for(let h=0;h<e.length;h++){const c=new Uint8Array(e[h]),d=c.findIndex(Z=>Z===10);if(d<0){o+=c.length;continue}d<c.length-1?(s.chunk=h,s.char=d+1):(s.chunk=h+1,s.char=0);const b=c[d-1]===13?-1:0;u=_(o+d+b,t);break}let f=0;o=u.byteLength;for(let h=0;h<=s.chunk;h++){let c=new Uint8Array(e[h]);c.length>o-f-1&&(c=c.subarray(0,o-f)),new Uint8Array(u).set(c,f),f+=c.length}o=0;for(let h=e.length-1;h>=0;h--){const c=new Uint8Array(e[h]),d=B(c,b=>b===10);if(d<0){o+=c.length;continue}a.chunk=h,a.char=d,l=_(o+c.length-1-d,t);break}f=l.byteLength-1,o=l.byteLength;for(let h=e.length-1;h>=a.chunk;h--){let c=new Uint8Array(e[h]);c.length>f&&(c=c.subarray(c.length-f-1)),new Uint8Array(l).set(c,f-c.length+1),f-=c.length}return{startRemainder:u,start:s,endRemainder:l,end:a}}function G(e,t){const n=new Array;let r=0,s=!1,a=!1;const u=l=>{n.push(e.substring(s?r+1:r,s?l-1:l))};for(let l=0;l<e.length;l++){if(e.charAt(l)==='"'){a=!a,s=!0;continue}if(a)continue;const{end:f,skip:h}=P(e,l,t);f&&(u(l),r=l+h,s=!1)}return u(void 0),n}function P(e,t,n){switch(e.charAt(t)){case n:case`
`:return{end:!0,skip:1};case"\r":if(e.charAt(t+1)===`
`)return{end:!0,skip:2};default:return{end:!1,skip:0}}}function k(e,t,n){switch(n.type){case i.Number:n.set(t,e);break;case i.Color:n.set(t,e);break;case i.Date:n.set(t,e);break;case i.String:n.set(t,e);break}}class N{constructor(t,n,r){this._type=t,this._length=n,this._offset=r}get type(){return this._type}get length(){return this._length}get offset(){return this._offset}set offset(t){this._offset=t}}class I extends N{get data(){return this._data}}class D extends I{constructor(t,n,r){super(i.Color,t,n),this._data=_(t*4*4,r),this._view=new Float32Array(this._data)}get view(){return this._view}get(t){return Array.from(this._view.subarray(t*4,(t+1)*4))}set(t,n){this._view.set(n,t*4)}}class M extends I{constructor(t,n,r){super(i.Date,t,n),this._data=_(t*w(i.Date),r),this._view=new Float64Array(this._data),this._min=Number.POSITIVE_INFINITY,this._max=Number.NEGATIVE_INFINITY}get view(){return this._view}get rawMin(){return this._min}get rawMax(){return this._max}get min(){return new Date(this._min)}get max(){return new Date(this._max)}updateExtrema(t){t<this._min&&(this._min=t),t>this._max&&(this._max=t)}rawGet(t){return this._view[t]}rawSet(t,n){this._view[t]=n,this.updateExtrema(n)}get(t){return new Date(this._view[t])}set(t,n){const r=n.getTime();this._view[t]=r,this.updateExtrema(r)}}class m extends I{constructor(t,n,r,s){super(i.Number,t,n),this._data=_(t*r,s),this._min=Number.POSITIVE_INFINITY,this._max=Number.NEGATIVE_INFINITY}get view(){return this._view}get min(){return this._min}get max(){return this._max}get(t){return this._view[t]}set(t,n){this._view[t]=n,n<this._min&&(this._min=n),n>this._max&&(this._max=n)}}class O extends m{constructor(t,n,r){super(t,n,w(i.Int8),r),this._view=new Int8Array(this._data)}}class Y extends m{constructor(t,n,r){super(t,n,w(i.Uint8),r),this._view=new Uint8Array(this._data)}}class W extends m{constructor(t,n,r){super(t,n,w(i.Int16),r),this._view=new Int16Array(this._data)}}class q extends m{constructor(t,n,r){super(t,n,w(i.Uint16),r),this._view=new Uint16Array(this._data)}}class H extends m{constructor(t,n,r){super(t,n,w(i.Int32),r),this._view=new Int32Array(this._data)}}class X extends m{constructor(t,n,r){super(t,n,w(i.Uint32),r),this._view=new Uint32Array(this._data)}}class $ extends m{constructor(t,n,r){super(t,n,w(i.Float32),r),this._view=new Float32Array(this._data)}}class j extends m{constructor(t,n,r){super(t,n,w(i.Float64),r),this._view=new Float64Array(this._data)}}class z extends N{constructor(t,n,r){super(i.String,t,n),this._data=new Array(t)}get(t){return this._data[t]}set(t,n){this._data[t]=n}}function C(e,t,n,r){switch(e){case i.Number:case i.Float32:return new $(t,n,r);case i.Int8:return new O(t,n,r);case i.Uint8:return new Y(t,n,r);case i.Int16:return new W(t,n,r);case i.Uint16:return new q(t,n,r);case i.Int32:return new H(t,n,r);case i.Uint32:return new X(t,n,r);case i.Float64:return new j(t,n,r);case i.Color:return new D(t,n,r);case i.Date:return new M(t,n,r);case i.String:return new z(t,n,r);default:return}}var A=(e=>(e[e.Start=0]="Start",e[e.Finished=1]="Finished",e))(A||{});const J=self;let g;J.onmessage=e=>{const t=e.data;e.data.type!==A.Start&&console.log("received invalid msg from sub worker:",t),K(t.data)};function K(e){g=e.options.sharedArrayBuffer;const t=V(e.chunks,g),n=F(e.chunks,t.start,t.end).map(o=>G(o,e.options.delimiter)),r=n.length+ +!e.lastChunk,s=e.columns.map(o=>C(o,r,0,g)),a=n.map(o=>L(o,e.columns));a.forEach((o,f)=>o.forEach((h,c)=>k(h,f,s[c])));const u=e.generatedColumns,l=u.map(o=>C(o.type,r,0,g));n.forEach((o,f)=>{u.map(c=>c.func(o,a[f])).forEach((c,d)=>k(c,f,l[d]))}),Q(s,l,t)}function Q(e,t,n){const r={chunks:e,generatedChunks:t,startRemainder:n.startRemainder,endRemainder:n.endRemainder},s={type:A.Finished,data:r},a=g?r.chunks.map(u=>u.data):[];postMessage(s,a)}})();
