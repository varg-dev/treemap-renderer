import{t as F,v as k,b as M,c as P}from"./index-yrmQOoAm.js";import{w as y,T as V,N as R,C as S,E as B,g as W,i as q,V as O}from"./example-D6mntx4T.js";import{p as K}from"./papaparse.min-lL-0_K96.js";const C=y.auxiliaries.log,N=y.auxiliaries.LogLevel;class U{}const g=class g{static initializeHeader(t){t.csv_delimiter=";",t.path_column="name"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const a=t.shift().substring(1).trim(),[o,n]=a.split("=").map(u=>u.trim());o=="delimiter"?e.csv_delimiter=n||";":o=="paths"?e.path_column=n||"name":o=="weights"?e.weight_column=n||"":o=="heights"?e.height_column=n||"":o=="colors"?e.color_column=n||"":o=="labels"?e.label_column=n||"":o=="heightScale"?e.height_scale=Number.parseFloat(n||"0.1")||.1:o=="colorScheme"?e.color_scheme=n||"Greens":C(N.Warning,"Unparsed header",o,"=",n)}}static parsePapaparseResult(t,e,a){const o=(i,r)=>i.meta.fields.indexOf(r)<0?new Array(i.data.length):i.data.map(l=>l[r]?l[r]:""),n=(i,r)=>{if(i.meta.fields.indexOf(r)<0){const l=new Array(i.data.length);return l.fill(-1),l}return i.data.map(l=>l[r]?parseFloat(l[r]):-1)},u=i=>t.meta.fields.indexOf(i)>=0,p=o(t,e.path_column);for(let i=0;i<p.length;++i)p[i]=p[i].replace("./","");const w=p.map(i=>i.split("/")),x=n(t,e.weight_column),A=n(t,e.height_column),m=n(t,e.color_column);u(e.label_column)?o(t,e.label_column):w.map(i=>i.at(-1));const s=(i,r)=>({parentIndex:r,index:i}),f=(i,r)=>"/"+i.slice(0,r).join("/"),c=new Array,H=new Map,v=new Array,b=new Array,_=new Array,d={};let h=-1;d["/"]=s(h,-1),h+=1,v.push(0),b.push(0),_.push(0),w.forEach((i,r)=>{i.forEach((L,l)=>{const T=f(i,l),E=f(i,l+1);if(!(T in d)){C(N.Warning,T,"not in",d);return}E in d||(d[E]=s(h,d[T].index),c.push(d[E].parentIndex),c.push(h),H.set(h,L),h+=1,l==i.length-1?(v.push(x[r]),b.push(A[r]),_.push(m[r])):(v.push(0),b.push(0),_.push(0)))})}),a.topology={edges:c,semantics:V.InputSemantics.ParentIdId,format:V.InputFormat.Interleaved},a.buffers=[{identifier:"source-weights",type:"numbers",data:v,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:b,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:_,linearization:"topology"}],a.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:1,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"},{type:"callback",iteration:"leaves",operation:i=>Math.pow(i,.25)}]}],a.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:e.color_scheme,steps:7}],a.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:R.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},a.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:e.height_scale},a.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:H},a.altered.alter("any")}static async loadAsync(t){const e=await t.text(),a=new U;g.initializeHeader(a);const o=e.split(`
`);g.parseHeader(o,a);const n=o.join(`
`);return this.loadAsyncHeader(n,a)}static loadAsyncHeader(t,e){return new Promise((a,o)=>{const n=new S;K.parse(t,{error:u=>o(u),complete:u=>{g.parsePapaparseResult(u,e,n),a(n)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};g.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let I=g;y.auxiliaries.log;y.auxiliaries.LogLevel;class $ extends B{get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=this.initialize(t),a=this._visualization.renderer,o=this._canvas,n=this._visualization,u=o.element;window.document.getElementById("fullscreen").onclick=()=>{y.viewer.Fullscreen.toggle(u)};const p=m=>{const s=n.configuration;try{n.configuration=m,n.update(),a.invalidate()}catch(f){if(console.log(f),s===void 0)return;const c=new S;c.topology=s.topology,c.layout=s.layout,c.buffers=s.buffers,c.bufferViews=s.bufferViews,c.colors=s.colors,c.geometry=s.geometry,c.labels=s.labels,n.configuration=c,n.update(),a.invalidate()}},w=document.getElementById("fileUpload"),x=document.getElementById("loadFile"),A=async()=>{const m=w.files;if(m===null)return;const s=m[0];s!==void 0&&I.loadAsync(s).then(f=>p(f))};return x.onclick=async()=>A(),window.gloperate=W,window.canvas=o,window.context=o.context,window.controller=o.controller,window.visualization=n,window.renderer=a,e}initialize(t){this._canvas=q(t),this._visualization=new O;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const z=document.getElementById("canvas"),t=new $;window.example=t,t.feature(z);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=F;document.title="treemap-renderer";document.querySelector("#version").innerHTML=k();document.querySelector("#branch").innerHTML=M();document.querySelector("#commit").innerHTML=P();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
