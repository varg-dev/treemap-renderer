import{t as z,v as L,b as A,c as E}from"./index-DIdt5DjF.js";import{w as v,N as I,T as _,C as T,p as C,E as H,g as P,i as V,V as N}from"./example-B1gPw968.js";const S=v.auxiliaries.log,M=v.auxiliaries.LogLevel;class R{}const m=class m{static initializeHeader(e){e.csv_delimiter=";",e.id_column="ids",e.parent_column="parents"}static initializeConfig(e){e.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Oranges",steps:7}],e.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:I.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},e.geometry={parentLayer:{showRoot:!0},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},e.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50}}static parseHeader(e,t){for(;e.length>=1&&e[0].startsWith("#");){const r=e.shift().substring(1).trim(),[o,i]=r.split("=").map(c=>c.trim());o=="delimiter"?t.csv_delimiter=i||";":o=="ids"?t.id_column=i||"ids":o=="parents"?t.parent_column=i||"parents":o=="weights"?t.weight_column=i||"":o=="heights"?t.height_column=i||"":o=="colors"?t.color_column=i||"":o=="labels"?t.label_column=i||"":S(M.Warning,"Unparsed header",o,"=",i)}}static parsePapaparseResult(e,t,r){const o=(n,a)=>{if(n.meta.fields.indexOf(a)<0)return new Uint32Array(n.data.length);const p=n.data.map(s=>s[a]?s[a]:0);return Uint32Array.from(p)},i=(n,a)=>{if(n.meta.fields.indexOf(a)<0)return new Float32Array(n.data.length);const p=n.data.map(s=>s[a]?s[a]:-1);return Float32Array.from([0].concat(p))},c=n=>e.meta.fields.indexOf(n)>=0,d=(n,a)=>n.meta.fields.indexOf(a)<0?new Array(n.data.length):n.data.map(s=>s[a]?s[a]:""),l=o(e,t.id_column),w=o(e,t.parent_column),f=i(e,t.weight_column),u=i(e,t.height_column),b=i(e,t.color_column),h=d(e,t.label_column),g=new Array;for(let n=0;n<l.length;n++){const a=l[n],p=w[n];g.push(p),g.push(a)}if(r.topology={edges:g,semantics:_.InputSemantics.ParentIdId,format:_.InputFormat.Interleaved},r.buffers=[{identifier:"source-weights",type:"numbers",data:f,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:u,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:b,linearization:"topology"}],r.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],c(t.label_column)){const n=new Map;for(let a=0;a<h.length;++a)n.set(l[a],h[a]);r.labels.names=n}r.altered.alter("any")}static loadAsync(e){const t=new R;m.initializeHeader(t);const r=e.split(`
`);m.parseHeader(r,t);const o=r.join(`
`);return this.loadAsyncHeader(o,t)}static loadAsyncHeader(e,t){return new Promise((r,o)=>{const i=new T;m.initializeConfig(i),C.parse(e,{error:c=>o(c),complete:c=>{m.parsePapaparseResult(c,t,i),r(i)},delimiter:t.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};m.FAILED=(e,t)=>`fetching '${e}' failed (${t.status}): ${t.statusText}`;let x=m;const O=v.auxiliaries.log,U=v.auxiliaries.LogLevel;class k extends H{obtainUrl(e){return window.location.origin+window.location.pathname+"?data="+e}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(e){return this.initialize(e)}preview(e){return this.initialize(e)}feature(e){const t=this.initialize(e),r=this._visualization.renderer,o=this._canvas,i=this._visualization,c=f=>{const u=i.configuration;try{i.configuration=f,r.invalidate()}catch{i.configuration=u,r.invalidate()}};window.gloperate=P,window.canvas=o,window.context=o.context,window.controller=o.controller,window.visualization=i,window.renderer=r;const d=window.document.getElementById("csv-data"),l=window.document.getElementById("data-hash"),w=window.document.getElementById("reload");if(d!==void 0){const u=new URLSearchParams(window.location.search).get("data");u&&(O(U.Debug,"Load from",u),d.value=atob(u)),d.oninput=b=>{const h=d.value;x.loadAsync(h).then(g=>{c(g),l!==void 0&&(l.textContent=this.obtainUrl(btoa(h)))})},d.oninput({})}return w!==void 0&&l!==void 0&&(w.onclick=f=>{l.textContent!==void 0&&l.textContent!==""&&(window.location.href=l.textContent)}),t&&d!==void 0}initialize(e){this._canvas=V(e),this._visualization=new N;const t=this._visualization.renderer;return this._canvas.renderer=t,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const y=document.getElementById("canvas"),e=new k;window.example=e,e.feature(y);const t=window.document.getElementById("context-about");t&&(t.innerText=context.aboutString())};window.treemaprenderer=z;document.title="treemap-renderer";document.querySelector("#version").innerHTML=L();document.querySelector("#branch").innerHTML=A();document.querySelector("#commit").innerHTML=E();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
