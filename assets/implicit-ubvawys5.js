import{t as S,v as V,b as M,c as R}from"./index-C1O4TDP0.js";import{w as _,T as H,N as k,C as B,p as O,E as W,g as $,i as q,V as F}from"./example-CdYP11SK.js";const N=_.auxiliaries.log,P=_.auxiliaries.LogLevel;class U{}const w=class w{static initializeHeader(t){t.csv_delimiter=";",t.path_column="name"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const i=t.shift().substring(1).trim(),[a,o]=i.split("=").map(l=>l.trim());a=="delimiter"?e.csv_delimiter=o||";":a=="paths"?e.path_column=o||"name":a=="weights"?e.weight_column=o||"":a=="heights"?e.height_column=o||"":a=="colors"?e.color_column=o||"":a=="labels"?e.label_column=o||"":N(P.Warning,"Unparsed header",a,"=",o)}}static parsePapaparseResult(t,e,i){const a=(n,r)=>n.meta.fields.indexOf(r)<0?new Array(n.data.length):n.data.map(s=>s[r]?s[r]:""),o=(n,r)=>n.meta.fields.indexOf(r)<0?new Array(n.data.length):n.data.map(s=>s[r]?parseFloat(s[r]):-1),l=n=>t.meta.fields.indexOf(n)>=0,c=a(t,e.path_column);for(let n=0;n<c.length;++n)c[n]=c[n].replace("./","");const m=c.map(n=>n.split("/")),p=o(t,e.weight_column),L=o(t,e.height_column),h=o(t,e.color_column);l(e.label_column)?a(t,e.label_column):m.map(n=>n.at(-1));const u=(n,r)=>({parentIndex:r,index:n}),v=(n,r)=>"/"+n.slice(0,r).join("/"),f=new Array,y=new Map,b=new Array,x=new Array,z=new Array,d={};let g=-1;d["/"]=u(g,-1),g+=1,b.push(0),x.push(0),z.push(0),m.forEach((n,r)=>{n.forEach((A,s)=>{const I=v(n,s),T=v(n,s+1);if(!(I in d)){N(P.Warning,I,"not in",d);return}T in d||(d[T]=u(g,d[I].index),f.push(d[T].parentIndex),f.push(g),y.set(g,A),g+=1,s==n.length-1?(b.push(p[r]),x.push(L[r]),z.push(h[r])):(b.push(0),x.push(0),z.push(0)))})}),i.topology={edges:f,semantics:H.InputSemantics.ParentIdId,format:H.InputFormat.Interleaved},i.buffers=[{identifier:"source-weights",type:"numbers",data:b,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:x,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:z,linearization:"topology"}],i.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],i.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Greens",steps:7}],i.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:k.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},i.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},i.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:y},i.altered.alter("any")}static loadAsync(t){const e=new U;w.initializeHeader(e);const i=t.split(`
`);w.parseHeader(i,e);const a=i.join(`
`);return this.loadAsyncHeader(a,e)}static loadAsyncHeader(t,e){return new Promise((i,a)=>{const o=new B;O.parse(t,{error:l=>a(l),complete:l=>{w.parsePapaparseResult(l,e,o),i(o)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};w.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let C=w;const K=_.auxiliaries.log,j=_.auxiliaries.LogLevel;class J extends W{obtainUrl(t){return window.location.origin+window.location.pathname+"?data="+t}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=window.document.getElementById("csv-data"),i=window.document.getElementById("data-hash"),a=window.document.getElementById("reload"),o=window.document.getElementById("config-display"),l=this.initialize(t),c=this._visualization.renderer,m=this._canvas,p=this._visualization,L=h=>{const u=p.configuration;try{p.configuration=h,c.invalidate(),o&&(o.textContent=JSON.stringify(h.toJSON(),null,2))}catch{p.configuration=u,c.invalidate()}};if(window.gloperate=$,window.canvas=m,window.context=m.context,window.controller=m.controller,window.visualization=p,window.renderer=c,e){const u=new URLSearchParams(window.location.search).get("data");u&&(K(j.Debug,"Load from",u),e.value=atob(u)),e.oninput=v=>{const f=e.value;C.loadAsync(f).then(y=>{L(y),i&&(i.textContent=this.obtainUrl(btoa(f)))})},e.oninput({})}return a&&i&&(a.onclick=h=>{i.textContent&&i.textContent!==""&&(window.location.href=i.textContent)}),l&&e!==void 0&&e!==null}initialize(t){this._canvas=q(t),this._visualization=new F;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const E=document.getElementById("canvas"),t=new J;window.example=t,t.feature(E);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=S;document.title="treemap-renderer";document.querySelector("#version").innerHTML=V();document.querySelector("#branch").innerHTML=M();document.querySelector("#commit").innerHTML=R();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
