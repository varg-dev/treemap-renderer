import{t as C,v as S,b as V,c as H}from"./index-CZFvxavq.js";import{w as v,T as E,N,C as L,E as M,g as P,i as k,V as B}from"./example-CAmKpJUL.js";import{p as O}from"./papaparse.min-D1KxGBLm.js";const R=v.auxiliaries.log,F=v.auxiliaries.LogLevel;class U{}const y=class y{static initializeHeader(t){t.csv_delimiter=";",t.id_column="ids",t.parent_column="parents"}static parseHeader(t,e){for(;t.length>=1&&t[0].startsWith("#");){const o=t.shift().substring(1).trim(),[u,l]=o.split("/"),[a,s]=u.split("=").map(c=>c.trim());a=="delimiter"?e.csv_delimiter=s||";":a=="ids"?e.id_column=s||"ids":a=="parents"?e.parent_column=s||"parents":a=="weights"?e.weight_column=s||"":a=="heights"?e.height_column=s||"":a=="colors"?(e.color_column=s||"",l&&(e.color_parameters=new Map(l.split(";").map(c=>c.split("="))))):a=="labels"?e.label_column=s||"":R(F.Warning,"Unparsed header",a,"=",s)}}static parsePapaparseResult(t,e,o){const u=(n,i)=>{if(n.meta.fields.indexOf(i)<0)return new Uint32Array(n.data.length);const h=n.data.map(d=>d[i]?d[i]:0);return Uint32Array.from(h)},l=(n,i)=>{if(n.meta.fields.indexOf(i)<0)return new Float32Array(n.data.length);let h=1;const d=new Map,A=()=>{var m;let w=!1;return(m=e.color_parameters)==null||m.forEach((T,J,j)=>{T&&(w=!0)}),w},I=n.data.map(w=>{let m=w[i]?w[i]:-1;if(isNaN(m)){if(e.color_parameters===void 0)return d.has(m)||d.set(m,h++),d.get(m);if(A())return e.color_parameters.get(m)?e.color_parameters.get(m):0}return m});return Float32Array.from([0].concat(I))},a=n=>t.meta.fields.indexOf(n)>=0,s=(n,i)=>n.meta.fields.indexOf(i)<0?new Array(n.data.length):n.data.map(d=>d[i]?d[i]:""),c=u(t,e.id_column),p=u(t,e.parent_column),_=l(t,e.weight_column),x=l(t,e.height_column),f=l(t,e.color_column),r=s(t,e.label_column),g=new Array;for(let n=0;n<c.length;n++){const i=c[n],h=p[n];g.push(h),g.push(i)}if(o.topology={edges:g,semantics:E.InputSemantics.ParentIdId,format:E.InputFormat.Interleaved},o.buffers=[{identifier:"source-weights",type:"numbers",data:_,linearization:"topology"},{identifier:"source-heights",type:"numbers",data:x,linearization:"topology"},{identifier:"source-colors",type:"numbers",data:f,linearization:"topology"}],o.bufferViews=[{identifier:"weights",source:"buffer:source-weights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"propagate-up",operation:"sum"}]},{identifier:"heights-normalized",source:"buffer:source-heights",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]},{identifier:"colors-normalized",source:"buffer:source-colors",transformations:[{type:"fill-invalid",value:0,invalidValue:-1},{type:"normalize",operation:"zero-to-max"}]}],a(e.label_column)){const n=new Map;for(let i=0;i<r.length;++i)n.set(c[i],r[i]);o.labels={innerNodeLayerRange:[1,2],numTopInnerNodes:50,numTopWeightNodes:50,numTopHeightNodes:50,numTopColorNodes:50,names:n}}o.colors=[{identifier:"emphasis",colorspace:"hex",value:"#00b0ff"},{identifier:"auxiliary",colorspace:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",colorspace:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"leaf",preset:"Set1",steps:6}],o.layout={algorithm:"snake",weight:"bufferView:weights",sort:{key:"bufferView:weights",algorithm:N.Algorithm.Keep},parentPadding:{type:"relative",value:.05},siblingMargin:{type:"relative",value:.05},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.02,.01,0],relativeAreaThreshold:.4,targetAspectRatio:8}},o.geometry={parentLayer:{showRoot:!1},leafLayer:{colorMap:"color:leaf",height:"bufferView:heights-normalized",colors:"bufferView:colors-normalized"},emphasis:{outline:new Array,highlight:new Array},heightScale:.5},o.altered.alter("any")}static loadAsync(t){const e=new U;y.initializeHeader(e);const o=t.split(`
`);y.parseHeader(o,e);const u=o.join(`
`);return this.loadAsyncHeader(u,e)}static loadAsyncHeader(t,e){return new Promise((o,u)=>{const l=new L;O.parse(t,{error:a=>u(a),complete:a=>{y.parsePapaparseResult(a,e,l),o(l)},delimiter:e.csv_delimiter,quoteChar:'"',escapeChar:'"',header:!0,comments:"#",skipEmptyLines:!0})})}};y.FAILED=(t,e)=>`fetching '${t}' failed (${e.status}): ${e.statusText}`;let z=y;const $=v.auxiliaries.log,q=v.auxiliaries.LogLevel;class W extends M{obtainUrl(t){return window.location.origin+window.location.pathname+"?data="+t}get canvas(){return this._canvas}get visualization(){return this._visualization}get renderer(){return this._renderer}validate(t){return this.initialize(t)}preview(t){return this.initialize(t)}feature(t){const e=window.document.getElementById("csv-data"),o=window.document.getElementById("data-hash"),u=window.document.getElementById("reload"),l=window.document.getElementById("config-display"),a=this.initialize(t),s=this._visualization.renderer,c=this._canvas,p=this._visualization,_=c.element;window.document.getElementById("fullscreen").onclick=()=>{v.viewer.Fullscreen.toggle(_)};const x=f=>{const r=p.configuration;try{p.configuration=f,p.update(),s.invalidate(),l&&(l.textContent=JSON.stringify(f.toJSON(),null,2))}catch(g){if(console.log(g),r===void 0)return;const n=new L;n.topology=r.topology,n.layout=r.layout,n.buffers=r.buffers,n.bufferViews=r.bufferViews,n.colors=r.colors,n.geometry=r.geometry,n.labels=r.labels,p.configuration=n,p.update(),s.invalidate()}};if(window.gloperate=P,window.canvas=c,window.context=c.context,window.controller=c.controller,window.visualization=p,window.renderer=s,e){const r=new URLSearchParams(window.location.search).get("data");r&&($(q.Debug,"Load from",r),e.value=atob(r)),e.oninput=g=>{const n=e.value;z.loadAsync(n).then(i=>{x(i),o&&(o.textContent=this.obtainUrl(btoa(n)))})},e.oninput({})}return u&&o&&(u.onclick=f=>{o.textContent&&o.textContent!==""&&(window.location.href=o.textContent)}),a&&e!==void 0&&e!==null}initialize(t){this._canvas=k(t),this._visualization=new B;const e=this._visualization.renderer;return this._canvas.renderer=e,super.expose(),!0}uninitialize(){this._canvas.dispose(),this._renderer.uninitialize()}}window.onload=function(){const b=document.getElementById("canvas"),t=new W;window.example=t,t.feature(b);const e=window.document.getElementById("context-about");e&&(e.innerText=context.aboutString())};window.treemaprenderer=C;document.title="treemap-renderer";document.querySelector("#version").innerHTML=S();document.querySelector("#branch").innerHTML=V();document.querySelector("#commit").innerHTML=H();document.querySelector("#cryear").innerHTML=new Date().getFullYear();
